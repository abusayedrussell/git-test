<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Working Line Numbers with Scroll Highlighting</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Courier New', monospace;
            font-size: 16px;
            line-height: 1.5;
            background: #2d2d2d;
            color: #ffffff;
        }

        .editor-container {
            display: flex;
            min-height: 100vh;
        }

        .line-numbers {
            background: #1e1e1e;
            color: #6e7681;
            padding: 20px 15px;
            min-width: 50px;
            text-align: right;
            border-right: 1px solid #444;
            position: sticky;
            top: 0;
            height: fit-content;
        }

        .line-number {
            display: block;
            height: 24px;
            line-height: 24px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .line-number.active {
            background: #0066cc;
            color: white;
            font-weight: bold;
            padding: 0 5px;
            margin: 0 -5px;
            border-radius: 3px;
        }

        .content {
            flex: 1;
            padding: 20px;
            background: #2d2d2d;
        }

        .content-line {
            height: 24px;
            line-height: 24px;
            margin: 0;
            padding: 0;
            transition: background-color 0.3s ease;
        }

        .content-line.highlight {
            background: rgba(0, 102, 204, 0.2);
        }

        .content-line:empty::before {
            content: " ";
            white-space: pre;
        }

        /* Sample content styling */
        .keyword { color: #ff7b72; }
        .string { color: #a5d6ff; }
        .comment { color: #8b949e; font-style: italic; }
        .function { color: #d2a8ff; }
        .variable { color: #ffa657; }

        h1, h2, h3 {
            color: #7dd3fc;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="editor-container">
        <div class="line-numbers" id="lineNumbers">
            <!-- Line numbers will be added by JS -->
        </div>
        
        <div class="content" id="content">
            <div class="content-line"><h1>Line Numbers Demo</h1></div>
            <div class="content-line"></div>
            <div class="content-line"><span class="comment">// This demonstrates active line highlighting</span></div>
            <div class="content-line"></div>
            <div class="content-line"><span class="keyword">function</span> <span class="function">highlightActiveLine</span>() {</div>
            <div class="content-line">    <span class="keyword">const</span> <span class="variable">lines</span> = document.querySelectorAll(<span class="string">'.content-line'</span>);</div>
            <div class="content-line">    <span class="keyword">const</span> <span class="variable">lineNumbers</span> = document.querySelectorAll(<span class="string">'.line-number'</span>);</div>
            <div class="content-line">    </div>
            <div class="content-line">    <span class="keyword">let</span> <span class="variable">activeIndex</span> = <span class="string">0</span>;</div>
            <div class="content-line">    </div>
            <div class="content-line">    <span class="keyword">for</span> (<span class="keyword">let</span> <span class="variable">i</span> = <span class="string">0</span>; <span class="variable">i</span> &lt; <span class="variable">lines</span>.length; <span class="variable">i</span>++) {</div>
            <div class="content-line">        <span class="keyword">const</span> <span class="variable">rect</span> = <span class="variable">lines</span>[<span class="variable">i</span>].getBoundingClientRect();</div>
            <div class="content-line">        </div>
            <div class="content-line">        <span class="keyword">if</span> (<span class="variable">rect</span>.top &lt;= <span class="string">100</span> && <span class="variable">rect</span>.bottom &gt; <span class="string">0</span>) {</div>
            <div class="content-line">            <span class="variable">activeIndex</span> = <span class="variable">i</span>;</div>
            <div class="content-line">            <span class="keyword">break</span>;</div>
            <div class="content-line">        }</div>
            <div class="content-line">    }</div>
            <div class="content-line">    </div>
            <div class="content-line">    <span class="comment">// Remove all active states</span></div>
            <div class="content-line">    <span class="variable">lineNumbers</span>.forEach(<span class="variable">ln</span> => <span class="variable">ln</span>.classList.remove(<span class="string">'active'</span>));</div>
            <div class="content-line">    <span class="variable">lines</span>.forEach(<span class="variable">line</span> => <span class="variable">line</span>.classList.remove(<span class="string">'highlight'</span>));</div>
            <div class="content-line">    </div>
            <div class="content-line">    <span class="comment">// Add active state to current line</span></div>
            <div class="content-line">    <span class="variable">lineNumbers</span>[<span class="variable">activeIndex</span>].classList.add(<span class="string">'active'</span>);</div>
            <div class="content-line">    <span class="variable">lines</span>[<span class="variable">activeIndex</span>].classList.add(<span class="string">'highlight'</span>);</div>
            <div class="content-line">}</div>
            <div class="content-line"></div>
            <div class="content-line"><h2>Features:</h2></div>
            <div class="content-line">✓ Line numbers on the left</div>
            <div class="content-line">✓ Active line highlighting</div>
            <div class="content-line">✓ Smooth scroll tracking</div>
            <div class="content-line">✓ Click-to-jump functionality</div>
            <div class="content-line">✓ Responsive design</div>
            <div class="content-line"></div>
            <div class="content-line"><h3>How to use:</h3></div>
            <div class="content-line">1. Scroll up and down to see active line change</div>
            <div class="content-line">2. Click on any line number to jump to that line</div>
            <div class="content-line">3. The highlighted line shows your current position</div>
            <div class="content-line"></div>
            <div class="content-line"><span class="keyword">class</span> <span class="function">ScrollTracker</span> {</div>
            <div class="content-line">    <span class="function">constructor</span>() {</div>
            <div class="content-line">        this.<span class="variable">isTracking</span> = <span class="keyword">true</span>;</div>
            <div class="content-line">        this.<span class="function">init</span>();</div>
            <div class="content-line">    }</div>
            <div class="content-line">    </div>
            <div class="content-line">    <span class="function">init</span>() {</div>
            <div class="content-line">        window.addEventListener(<span class="string">'scroll'</span>, this.<span class="function">handleScroll</span>);</div>
            <div class="content-line">        this.<span class="function">updateLineNumbers</span>();</div>
            <div class="content-line">    }</div>
            <div class="content-line">}</div>
            <div class="content-line"></div>
            <div class="content-line">Keep scrolling to see more content...</div>
            <div class="content-line"></div>
            <div class="content-line">Lorem ipsum dolor sit amet, consectetur adipiscing elit.</div>
            <div class="content-line">Sed do eiusmod tempor incididunt ut labore et dolore.</div>
            <div class="content-line">Ut enim ad minim veniam, quis nostrud exercitation.</div>
            <div class="content-line">Duis aute irure dolor in reprehenderit in voluptate.</div>
            <div class="content-line">Excepteur sint occaecat cupidatat non proident.</div>
            <div class="content-line">Sunt in culpa qui officia deserunt mollit anim.</div>
            <div class="content-line"></div>
            <div class="content-line">At vero eos et accusamus et iusto odio dignissimos.</div>
            <div class="content-line">Ducimus qui blanditiis praesentium voluptatum.</div>
            <div class="content-line">Deleniti atque corrupti quos dolores et quas.</div>
            <div class="content-line">Molestias excepturi sint occaecati cupiditate.</div>
            <div class="content-line">Non provident, similique sunt in culpa qui.</div>
            <div class="content-line"></div>
            <div class="content-line">Temporibus autem quibusdam et aut officiis.</div>
            <div class="content-line">Debitis aut rerum necessitatibus saepe eveniet.</div>
            <div class="content-line">Ut et voluptates repudiandae sint et molestiae.</div>
            <div class="content-line">Non recusandae itaque earum rerum hic tenetur.</div>
            <div class="content-line"></div>
            <div class="content-line"><span class="comment">// End of demo content</span></div>
            <div class="content-line">Thank you for testing the line number feature!</div>
            <div class="content-line">Try clicking on different line numbers above.</div>
            <div class="content-line">Try clicking on different line numbers above.</div>
        </div>
    </div>

    <script>
        let totalLines = 0;

        function createLineNumbers() {
            const content = document.getElementById('content');
            const lineNumbers = document.getElementById('lineNumbers');
            const lines = content.querySelectorAll('.content-line');
            
            totalLines = lines.length;
            lineNumbers.innerHTML = '';
            
            for (let i = 1; i <= totalLines; i++) {
                const lineNumber = document.createElement('span');
                lineNumber.className = 'line-number';
                lineNumber.textContent = i;
                lineNumber.onclick = function() {
                    scrollToLine(i - 1);
                };
                lineNumbers.appendChild(lineNumber);
            }
        }

        function scrollToLine(lineIndex) {
            const lines = document.querySelectorAll('.content-line');
            if (lines[lineIndex]) {
                lines[lineIndex].scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'start' 
                });
            }
        }

        function updateActiveLineHighlight() {
            const lines = document.querySelectorAll('.content-line');
            const lineNumbers = document.querySelectorAll('.line-number');
            
            let activeIndex = 0;
            
            // Find the line that's currently at the top of the viewport
            for (let i = 0; i < lines.length; i++) {
                const rect = lines[i].getBoundingClientRect();
                if (rect.top <= 50 && rect.bottom > 0) {
                    activeIndex = i;
                }
            }
            
            // Remove all active classes
            lineNumbers.forEach(ln => ln.classList.remove('active'));
            lines.forEach(line => line.classList.remove('highlight'));
            
            // Add active class to current line
            if (lineNumbers[activeIndex] && lines[activeIndex]) {
                lineNumbers[activeIndex].classList.add('active');
                lines[activeIndex].classList.add('highlight');
            }
        }

        // Throttle scroll events for better performance
        let scrollTimeout;
        function handleScroll() {
            if (scrollTimeout) {
                clearTimeout(scrollTimeout);
            }
            scrollTimeout = setTimeout(updateActiveLineHighlight, 10);
        }

        // Initialize everything when page loads
        document.addEventListener('DOMContentLoaded', function() {
            createLineNumbers();
            updateActiveLineHighlight();
            window.addEventListener('scroll', handleScroll);
        });
    </script>
</body>
</html>